# Dockerfile.dev
FROM node:20-alpine

# 更稳的国内源 + 直接全局安装 pnpm（绕过 corepack 的网络不稳定）
RUN npm config set registry https://registry.npmmirror.com \
  && npm i -g pnpm@9 \
  && apk add --no-cache bash su-exec libc6-compat

ENV NEXT_TELEMETRY_DISABLED=1
WORKDIR /app

# 只拷贝必要的包管理文件（不要拷贝 pnpm-workspace.yaml）
COPY package.json ./
COPY pnpm-lock.yaml* ./

RUN pnpm install

CMD ["bash", "-lc", "pnpm dev"]
